<!-- Navbar -->
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
  <div class="container-fluid">
    <a class="navbar-brand fw-bold" style="cursor: pointer;">âš–ï¸ Panel del
      Asesor</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
      data-bs-target="#navbarNav">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav me-auto">
        <li class="nav-item">
          <a class="nav-link"
            [class.active]="vistaActiva === 'dashboard'"
            (click)="cambiarVista('dashboard')"
            style="cursor: pointer;">
            Dashboard
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link"
            [class.active]="vistaActiva === 'agenda'"
            (click)="cambiarVista('agenda')"
            style="cursor: pointer;">
            Agenda
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link"
            [class.active]="vistaActiva === 'consultas'"
            (click)="cambiarVista('consultas')"
            style="cursor: pointer;">
            Consultas
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link"
            [class.active]="vistaActiva === 'clientes'"
            (click)="cambiarVista('clientes')"
            style="cursor: pointer;">
            Clientes
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link"
            [class.active]="vistaActiva === 'casos'"
            (click)="cambiarVista('casos')"
            style="cursor: pointer;">
            Mis Casos
          </a>
        </li>
      </ul>

      <div class="dropdown">
        <button
          class="btn btn-link dropdown-toggle text-white text-decoration-none"
          type="button"
          data-bs-toggle="dropdown">
          <span>{{ usuario?.nombre || 'Asesor' }}</span>
        </button>
        <ul class="dropdown-menu dropdown-menu-end">
          <li><a class="dropdown-item" style="cursor: pointer;">Mi
              Perfil</a></li>
          <li><a class="dropdown-item"
              style="cursor: pointer;">ConfiguraciÃ³n</a></li>
          <li><hr class="dropdown-divider"></li>
          <li><a class="dropdown-item text-danger" (click)="cerrarSesion()"
              style="cursor: pointer;">Cerrar SesiÃ³n</a></li>
        </ul>
      </div>
    </div>
  </div>
</nav>

<!-- VISTA: DASHBOARD -->
<div *ngIf="vistaActiva === 'dashboard'">

  <!-- Hero Section -->
  <section class="panel-hero">
    <div class="container">
      <h1>Bienvenido/a, {{ usuario?.nombre || 'Asesor' }} ğŸ‘‹</h1>
      <p>Gestiona tus turnos, consultas y casos de manera eficiente</p>
    </div>
  </section>

  <div class="container">

    <!-- EstadÃ­sticas -->
    <div class="row mb-4">
      <div class="col-md-3">
        <div class="stat-card">
          <div class="stat-icon">ğŸ“…</div>
          <div class="stat-value">{{ estadisticas.turnosSemana }}</div>
          <div class="stat-label">Turnos Esta Semana</div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="stat-card" style="border-left-color: #ffc107;">
          <div class="stat-icon">ğŸ’¬</div>
          <div class="stat-value">{{ estadisticas.consultasPendientes }}</div>
          <div class="stat-label">Consultas Pendientes</div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="stat-card" style="border-left-color: #198754;">
          <div class="stat-icon">ğŸ“‚</div>
          <div class="stat-value">{{ estadisticas.casosActivos }}</div>
          <div class="stat-label">Casos Activos</div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="stat-card" style="border-left-color: #6f42c1;">
          <div class="stat-icon">ğŸ‘¥</div>
          <div class="stat-value">{{ estadisticas.clientesTotales }}</div>
          <div class="stat-label">Clientes</div>
        </div>
      </div>
    </div>

    <!-- Acciones RÃ¡pidas -->
    <h5 class="mb-3">Acciones RÃ¡pidas</h5>
    <div class="quick-actions">
      <a (click)="cambiarVista('agenda')" class="quick-action-btn"
        style="cursor: pointer;">
        <div class="quick-action-icon">ğŸ“…</div>
        <div class="quick-action-label">Ver Agenda</div>
      </a>
      <a (click)="cambiarVista('consultas')" class="quick-action-btn"
        style="cursor: pointer;">
        <div class="quick-action-icon">âœ‰ï¸</div>
        <div class="quick-action-label">Responder Consultas</div>
      </a>
      <a (click)="cambiarVista('casos')" class="quick-action-btn"
        style="cursor: pointer;">
        <div class="quick-action-icon">ğŸ“‚</div>
        <div class="quick-action-label">Gestionar Casos</div>
      </a>
      <a (click)="cambiarVista('clientes')" class="quick-action-btn"
        style="cursor: pointer;">
        <div class="quick-action-icon">ğŸ‘¥</div>
        <div class="quick-action-label">Ver Clientes</div>
      </a>
    </div>

    <!-- Contenido en dos columnas -->
    <div class="row mt-4">

      <!-- Columna Izquierda -->
      <div class="col-lg-8">

        <!-- PrÃ³ximos Turnos -->
        <div class="content-card">
          <h5>ğŸ“… PrÃ³ximos Turnos del DÃ­a</h5>
          <ul class="item-list">
            <li *ngFor="let turno of getProximosTurnos()">
              <div>
                <div class="item-title">{{ turno.clienteNombre }} - {{
                  turno.asunto }}</div>
                <div class="item-date">{{ turno.hora }} - {{ turno.horaFin }}
                  hs</div>
              </div>
              <span class="badge" [ngClass]="getEstadoClass(turno.estado)">
                {{ getEstadoTexto(turno.estado) }}
              </span>
            </li>
            <li *ngIf="getProximosTurnos().length === 0">
              <div class="text-muted">No hay turnos programados para hoy</div>
            </li>
          </ul>
        </div>

      </div>

      <!-- Columna Derecha -->
      <div class="col-lg-4">

        <!-- Actividad Reciente -->
        <div class="content-card">
          <h5>ğŸ•’ Actividad Reciente</h5>
          <div class="timeline">
            <div class="timeline-item">
              <div class="timeline-date">Hace 1 hora</div>
              <div class="timeline-content">
                <strong>Nueva Consulta</strong><br>
                <small>Cliente: MarÃ­a GonzÃ¡lez</small>
              </div>
            </div>
            <div class="timeline-item">
              <div class="timeline-date">Hace 2 horas</div>
              <div class="timeline-content">
                <strong>Turno Confirmado</strong><br>
                <small>Hoy a las 19:00 hs</small>
              </div>
            </div>
          </div>
        </div>

        <!-- Recordatorios -->
        <div class="content-card">
          <h5>ğŸ“Œ Recordatorios</h5>
          <div class="alert alert-warning mb-2">
            <small><strong>Audiencia</strong><br>MaÃ±ana 10:00 - Caso
              #2024-001</small>
          </div>
          <div class="alert alert-info mb-0">
            <small><strong>Vencimiento</strong><br>PresentaciÃ³n documentos -
              Caso #2024-003</small>
          </div>
        </div>

      </div>
    </div>

  </div>
</div>

<!-- VISTA: AGENDA -->
<div *ngIf="vistaActiva === 'agenda'">

  <!-- Hero Section -->
  <section class="panel-hero">
    <div class="container">
      <h1>ğŸ“… Mi Agenda</h1>
      <p>Gestiona tus turnos y disponibilidad</p>
    </div>
  </section>

  <div class="container">

    <!-- Selector de Fechas -->
    <div class="content-card" *ngIf="mostrarSelectorFecha">
      <h5>Selecciona una fecha</h5>
      <app-selector-fecha
        [fechasDisponibles]="fechasConTurnos"
        (fechaSeleccionadaEvent)="onFechaSeleccionada($event)">
      </app-selector-fecha>
    </div>

    <!-- Tabla de Agenda -->
    <div class="content-card">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h5 class="mb-0">Agenda Semanal</h5>
        <div class="btn-group">
          <button class="btn btn-sm btn-outline-primary"
            (click)="semanaAnterior()">
            â† Semana Anterior
          </button>
          <button class="btn btn-sm btn-primary" (click)="irAHoy()">
            Hoy
          </button>
          <button class="btn btn-sm btn-outline-primary"
            (click)="semanaSiguiente()">
            Semana Siguiente â†’
          </button>
        </div>
      </div>

      <div class="alert alert-info">
        <small><strong>â„¹ï¸ Tip:</strong> Haz clic en los slots para ver detalles
          o marcar como disponible/ocupado</small>
      </div>

      <!-- Tabla responsive -->
      <div class="table-responsive">
        <table class="agenda-table table">
          <thead>
            <tr>
              <th style="width: 100px;">Horario</th>
              <th *ngFor="let dia of dias">{{ dia.nombre }}</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let slotHora of agendaSemanal">
              <td class="time-column">{{ slotHora.hora }}</td>
              <td *ngFor="let slot of slotHora.slots"
                [class.slot-disponible]="slot.disponible"
                [class.slot-ocupado]="!slot.disponible"
                (click)="clickSlotAgenda(slot)"
                style="cursor: pointer; vertical-align: top; min-height: 80px;">
                <div *ngIf="slot.disponible">
                  <span class="text-success fw-bold">âœ“ Disponible</span>
                </div>
                <div *ngIf="!slot.disponible && slot.turno">
                  <strong>{{ slot.turno.clienteNombre }}</strong><br>
                  <small>{{ slot.turno.asunto }}</small><br>
                  <span class="badge"
                    [ngClass]="getEstadoClass(slot.turno.estado)">
                    {{ getEstadoTexto(slot.turno.estado) }}
                  </span>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Leyenda -->
      <div class="leyenda mt-3">
        <div class="leyenda-item">
          <div class="leyenda-color" style="background-color: #d1e7dd;"></div>
          <span>Disponible</span>
        </div>
        <div class="leyenda-item">
          <div class="leyenda-color" style="background-color: #cfe2ff;"></div>
          <span>Ocupado</span>
        </div>
        <div class="leyenda-item">
          <div class="leyenda-color" style="background-color: #fff3cd;"></div>
          <span>Pendiente ConfirmaciÃ³n</span>
        </div>
      </div>
    </div>

    <!-- Lista de Turnos del DÃ­a -->
    <div class="content-card" *ngIf="fechaSeleccionadaCalendario">
      <h5>ğŸ“‹ Turnos del {{ fechaSeleccionadaCalendario.fechaTexto }}</h5>

      <div class="alert alert-info" *ngIf="getTurnosDelDia().length === 0">
        No hay turnos agendados para este dÃ­a
      </div>

      <div *ngFor="let turno of getTurnosDelDia()"
        class="turno-asesor-card mb-3">
        <div class="d-flex justify-content-between align-items-start">
          <div>
            <h6 class="mb-1">
              {{ turno.hora }} - {{ turno.horaFin }} | {{ turno.clienteNombre }}
            </h6>
            <p class="mb-1"><strong>Asunto:</strong> {{ turno.asunto }}</p>
            <div class="mb-2">
              <span class="badge" [ngClass]="getEstadoClass(turno.estado)">
                {{ getEstadoTexto(turno.estado) }}
              </span>
              <span class="badge bg-secondary ms-2">Caso #{{ turno.caso
                }}</span>
            </div>
            <small class="text-muted">
              Creado: {{ turno.fechaCreacion }} | Confirmado: {{
              turno.fechaConfirmacion || 'Pendiente' }}
            </small>
          </div>
          <div class="d-flex flex-column gap-2">
            <button class="btn btn-sm btn-success"
              *ngIf="turno.estado === 'pendiente'"
              (click)="confirmarTurno(turno)">
              âœ… Confirmar
            </button>
            <button class="btn btn-sm btn-primary"
              *ngIf="turno.estado === 'confirmado'"
              (click)="marcarTurnoCompletado(turno)">
              âœ”ï¸ Completado
            </button>
            <button class="btn btn-sm btn-outline-primary"
              (click)="verDetallesTurno(turno)">
              ğŸ‘ï¸ Ver Detalles
            </button>
          </div>
        </div>
      </div>
    </div>

  </div>
</div>

<!-- VISTA: CONSULTAS -->
<div *ngIf="vistaActiva === 'consultas'">

  <section class="panel-hero">
    <div class="container">
      <h1>ğŸ’¬ Consultas</h1>
      <p>Gestiona las consultas de tus clientes</p>
    </div>
  </section>

  <div class="container">
    <div class="content-card">
      <h5>Consultas Pendientes ({{ getConsultasPendientes().length }})</h5>

      <div *ngIf="getConsultasPendientes().length === 0"
        class="alert alert-info">
        No hay consultas pendientes de responder
      </div>

      <div *ngFor="let consulta of getConsultasPendientes()"
        class="item-list mb-3 border rounded p-3">
        <div class="d-flex justify-content-between align-items-start">
          <div class="flex-grow-1">
            <h6 class="mb-2">
              {{ consulta.asunto }}
              <span class="badge bg-warning text-dark ms-2"
                *ngIf="consulta.urgente">Urgente</span>
            </h6>
            <p class="mb-2">{{ consulta.mensaje }}</p>
            <small class="text-muted">
              Cliente: {{ consulta.clienteNombre }} |
              Email: {{ consulta.clienteEmail }} |
              Fecha: {{ consulta.fecha }}
            </small>
          </div>
          <div>
            <button class="btn btn-sm btn-primary"
              (click)="abrirModalRespuesta(consulta)">
              Responder
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- VISTA: CASOS -->

<!-- CASOS - NUEVA SECCIÃ“N -->
<div *ngIf="vistaActiva === 'casos'">
  <section class="panel-hero">
    <div class="container">
      <h1>ğŸ“‚ Casos</h1>
      <p>Gestiona todos tus casos activos</p>
    </div>
  </section>
</div>

<!-- VISTA: CLIENTES -->
<div *ngIf="vistaActiva === 'clientes'">

  <section class="panel-hero">
    <div class="container">
      <h1>ğŸ‘¥ Clientes</h1>
      <p>Lista de todos tus clientes</p>
    </div>
  </section>

  <div class="container">
    <div class="content-card">
      <h5>Clientes Activos ({{ clientes.length }})</h5>

      <div *ngFor="let cliente of clientes" class="border-bottom pb-3 mb-3">
        <div class="d-flex justify-content-between">
          <div>
            <h6>{{ cliente.nombre }}</h6>
            <p class="mb-1"><small>Email: {{ cliente.email }} | Tel: {{
                cliente.telefono }}</small></p>
            <p class="mb-0"><small>Casos activos: {{ cliente.casosActivos }} |
                Ãšltima consulta: {{ cliente.ultimaConsulta }}</small></p>
          </div>
          <div>
            <button class="btn btn-sm btn-outline-primary">Ver Perfil</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<router-outlet></router-outlet>

<!-- Modal Responder Consulta -->
<div class="modal fade"
  [class.show]="mostrarModalConsulta"
  [style.display]="mostrarModalConsulta ? 'block' : 'none'"
  tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Responder Consulta</h5>
        <button type="button" class="btn-close"
          (click)="cerrarModalConsulta()"></button>
      </div>
      <div class="modal-body" *ngIf="consultaSeleccionada">
        <div class="mb-3">
          <strong>Cliente:</strong> {{ consultaSeleccionada.clienteNombre }}<br>
          <strong>Asunto:</strong> {{ consultaSeleccionada.asunto }}<br>
          <strong>Mensaje:</strong>
          <p class="mt-2">{{ consultaSeleccionada.mensaje }}</p>
        </div>
        <div class="mb-3">
          <label for="respuesta" class="form-label">Tu respuesta:</label>
          <textarea class="form-control"
            [(ngModel)]="respuestaConsulta"
            rows="5"
            placeholder="Escribe tu respuesta aquÃ­..."></textarea>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary"
          (click)="cerrarModalConsulta()">Cancelar</button>
        <button type="button" class="btn btn-primary"
          (click)="enviarRespuestaConsulta()">Enviar Respuesta</button>
      </div>
    </div>
  </div>
</div>

<!-- Backdrop del modal -->
<div class="modal-backdrop fade"
  [class.show]="mostrarModalConsulta"
  *ngIf="mostrarModalConsulta"
  (click)="cerrarModalConsulta()"></div>

<!-- Footer -->
<footer class="bg-dark text-white py-4 mt-5">
  <div class="container">
    <div class="row">
      <div class="col-md-6">
        <h5>Estudio JurÃ­dico</h5>
        <p class="small">Panel del Asesor</p>
      </div>
      <div class="col-md-6 text-md-end">
        <p class="small mb-0">&copy; 2024 Estudio JurÃ­dico. Todos los derechos
          reservados.</p>
      </div>
    </div>
  </div>
</footer>
